# Dr. Paws - Android Deployment Guide

This guide explains how to build and deploy the Dr. Paws app to the Google Play Store for internal testing.

## Project Structure

- `drpaws-app/` - React + Vite frontend application
- `backend/` - Node.js backend proxy for Gemini API (for future production use)
- `drpaws-app/android/` - Native Android project generated by Capacitor

## Prerequisites

1. **Node.js** (v18 or higher)
2. **Android Studio** (latest version)
3. **Java Development Kit (JDK)** 11 or higher
4. **Gemini API Key** from Google AI Studio

## Setup Instructions

### 1. Frontend Setup

```bash
cd drpaws-app
npm install
```

### 2. Configure API Key

For internal testing, the app uses the Gemini API key directly. Create a `.env.local` file:

```bash
cd drpaws-app
echo "GEMINI_API_KEY=your_api_key_here" > .env.local
```

**IMPORTANT**: For production, you should use the backend proxy instead (see Backend Setup section).

### 3. Build the Web App

```bash
npm run build
```

### 4. Sync with Capacitor

```bash
npx cap sync android
```

### 5. Open in Android Studio

```bash
npx cap open android
```

This will open the Android project in Android Studio.

## Building for Internal Testing

### Generate Debug APK

1. In Android Studio, go to **Build > Build Bundle(s) / APK(s) > Build APK(s)**
2. Wait for the build to complete
3. The APK will be located at: `drpaws-app/android/app/build/outputs/apk/debug/app-debug.apk`

### Generate Release AAB (for Play Store)

1. In Android Studio, go to **Build > Generate Signed Bundle / APK**
2. Select **Android App Bundle**
3. Create a new keystore or use an existing one:
   - **Keystore path**: Choose a secure location
   - **Password**: Use a strong password
   - **Key alias**: `drpaws-upload-key`
   - **Key password**: Use a strong password
   - **Validity**: 25 years or more
   - **Certificate info**: Fill in your organization details
4. Select **release** build variant
5. Click **Finish**
6. The AAB will be located at: `drpaws-app/android/app/build/outputs/bundle/release/app-release.aab`

**IMPORTANT**: Keep your keystore file and passwords secure. You'll need them for all future updates.

## Google Play Console Setup

### 1. Create App Entry

1. Go to [Google Play Console](https://play.google.com/console)
2. Click **Create app**
3. Fill in the details:
   - **App name**: Dr. Paws
   - **Default language**: English (United States)
   - **App or game**: App
   - **Free or paid**: Free

### 2. Store Listing

Fill in the required information:

- **App name**: Dr. Paws
- **Short description**: AI-powered pet health and emotion tracker
- **Full description**: Detailed description of the app's features
- **App icon**: 512x512 PNG (high-res icon)
- **Feature graphic**: 1024x500 PNG
- **Screenshots**: At least 2 phone screenshots (minimum 320px on shortest side)

### 3. Content Rating

Complete the content rating questionnaire. The app should receive an appropriate rating based on its features.

### 4. Privacy Policy

**REQUIRED**: You must provide a privacy policy URL before publishing. The privacy policy should cover:

- What data is collected (photos, pet information, audio recordings)
- How data is used (AI analysis via Google Gemini)
- Data sharing with third parties (Google AI services)
- User rights and data deletion

### 5. Data Safety

Declare the data types collected:

- **Photos and videos**: Yes (for pet analysis)
- **Audio files**: Yes (for vocalization analysis)
- **App activity**: Yes (usage analytics)
- **Device or other IDs**: Yes (for notifications)

Data sharing:
- Data is shared with Google Gemini AI for processing
- Data is not sold to third parties

### 6. App Access

If the app requires a Gemini API key, provide test credentials for reviewers.

### 7. Upload to Internal Testing

1. Go to **Testing > Internal testing**
2. Click **Create new release**
3. Upload the AAB file
4. Add release notes
5. Click **Review release**
6. Click **Start rollout to Internal testing**

### 8. Add Testers

1. Go to **Testing > Internal testing > Testers**
2. Create an email list of testers
3. Share the opt-in URL with your testers

## Backend Proxy Setup (For Production)

For production deployment, use the backend proxy to secure the API key:

### 1. Deploy Backend

```bash
cd backend
npm install

# Set environment variable
echo "GEMINI_API_KEY=your_api_key_here" > .env

# Start the server
npm start
```

The backend will run on port 3001 by default.

### 2. Deploy to Production

Deploy the backend to a hosting service like:
- Heroku
- Railway
- Render
- Google Cloud Run
- AWS Elastic Beanstalk

### 3. Update Frontend

Update `drpaws-app/services/geminiService.ts` to call the backend API instead of Gemini directly.

## App Configuration

### Package ID
- **Package ID**: `de.tklengineering.drpaws`
- **App Name**: Dr. Paws

### Permissions

The app requires the following permissions (already configured in AndroidManifest.xml):

- `INTERNET` - For API calls
- `POST_NOTIFICATIONS` - For local notifications (Android 13+)
- `CAMERA` - For taking pet photos
- `READ_EXTERNAL_STORAGE` - For selecting photos
- `WRITE_EXTERNAL_STORAGE` - For saving reports

### Notification Configuration

The app uses Capacitor Local Notifications plugin for native notifications. Notifications are automatically configured and will work on Android 13+ with proper permission handling.

## Troubleshooting

### Build Fails

1. Make sure you have the latest Android SDK installed
2. Check that Java 11+ is installed: `java -version`
3. Clean and rebuild: **Build > Clean Project**, then **Build > Rebuild Project**

### API Key Issues

1. Verify the API key is set in `.env.local`
2. Rebuild the app: `npm run build && npx cap sync android`
3. Check the browser console for errors

### Capacitor Sync Issues

```bash
# Remove and re-add Android platform
npx cap remove android
npx cap add android
npx cap sync android
```

## Testing Checklist

Before submitting to Play Store:

- [ ] App launches successfully
- [ ] Pet profile creation works
- [ ] Photo/video upload works
- [ ] AI analysis generates reports
- [ ] Notifications work correctly
- [ ] App doesn't crash on rotation
- [ ] Back button navigation works
- [ ] All features work offline (where applicable)
- [ ] Privacy policy is accessible
- [ ] No hardcoded API keys in production build

## Next Steps

1. **Internal Testing**: Test with a small group of users
2. **Closed Testing**: Expand to a larger group
3. **Open Testing**: Public beta testing
4. **Production**: Full release to all users

## Important Notes

- **API Key Security**: Never commit API keys to version control
- **Keystore Security**: Keep your keystore file and passwords secure
- **Privacy Policy**: Required before production release
- **App Updates**: Use the same keystore for all future updates
- **Testing**: Thoroughly test on multiple Android devices and versions

## Support

For issues or questions:
- Check the [Capacitor Documentation](https://capacitorjs.com/docs)
- Review [Google Play Console Help](https://support.google.com/googleplay/android-developer)
- Contact: thomaskuempfel@tklengineering.de
